<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#667eea" />
    
    <title>Dashboard - PG Management</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" href="assets/icon-192.png" />
    <link rel="apple-touch-icon" href="assets/icon-192.png" />
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    
    <!-- ===== SCRIPT LOADING ORDER - CRITICAL ===== -->
    <!-- 1. Supabase library first -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- 2. Config second -->
    <script src="js/config.js"></script>
    
    <!-- 3. Supabase client third -->
    <script src="js/supabase-client.js"></script>
    
    <!-- 4. Initialize Supabase -->
    <script>
        if (window.supabaseClient && window.supabaseClient.init) {
            window.supabaseClient.init();
            console.log("âœ… Supabase initialized on login page");
        }
    </script>
    <!-- ===== END SCRIPT LOADING ORDER ===== -->
    
    <style>
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
        gap: 28px;
        margin-bottom: 38px;
      }
      .stat-card {
        display: flex;
        align-items: center;
        gap: 22px;
        background: var(--card-bg, #fff);
        border-radius: 18px;
        box-shadow: 0 5px 24px rgba(102,126,234,0.10), 0 2px 8px rgba(51,51,51,0.07);
        padding: 29px 32px;
        transition: transform .23s, box-shadow .23s;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }
      .stat-card::before {
        content: "";
        position: absolute; left: -20px; top: -20px;
        width: 85px; height: 85px; opacity: 0.13; border-radius: 50%;
        background: linear-gradient(135deg,var(--primary-color),var(--accent-2));
        z-index: 0;
      }
      .stat-card:hover {
        transform: translateY(-6px) scale(1.035);
        box-shadow: 0 8px 32px rgba(76,172,254,0.13),0 3px 18px rgba(76,172,254,0.11);
      }
      .stat-icon {
        font-size: 45px;
        border-radius: 12px;
        background: linear-gradient(135deg,var(--accent-2,#4facfe),var(--accent-1,#f093fb));
        color: #fff;
        padding: 18px;
        box-shadow: 0 3px 16px rgba(76, 172, 254, 0.11);
        display: flex;
        align-items: center; justify-content: center;
        z-index: 1;
      }
      .stat-primary .stat-icon { background: linear-gradient(135deg,var(--primary-color),var(--accent-1)); }
      .stat-success .stat-icon { background: linear-gradient(135deg,var(--success-color),var(--accent-3)); }
      .stat-warning .stat-icon { background: linear-gradient(135deg,var(--warning-color),var(--accent-5)); }
      .stat-danger .stat-icon { background: linear-gradient(135deg,var(--danger-color),var(--accent-4)); }
      .stat-number {
        font-size: 2.3rem; font-weight: bold; color: var(--primary-dark, #5568d3); margin-bottom: 3px;
      }
      .stat-label {
        font-size: 1.07rem; font-weight: 600; color: var(--text-secondary, #64748b);
      }
      .dashboard-sections-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit,minmax(340px,1fr));
        gap: 28px;
        margin-bottom: 28px;
      }
      .section-card {
        background: var(--card-bg,#fff);
        border-radius: 16px;
        box-shadow: 0 3px 16px rgba(102,126,234,0.07);
        padding: 25px 28px 20px 28px;
        transition: box-shadow .23s;
        margin-bottom: 0 !important;
        min-height: 195px;
        display: flex;
        flex-direction: column;
        gap: 18px;
      }
      .section-header h2 {
        font-size: 1.2rem;
        color: var(--primary-dark, #5568d3);
        font-weight: 700;
        margin: 0 0 16px 0;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .mini-stat {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 1rem;
        color: var(--text-secondary);
        margin-right: 14px;
        margin-bottom: 8px;
      }
      .mini-stat i { font-size: 1.13em; color: var(--primary-color); margin-right: 4px; }
      .mini-stat.stat-success i { color: var(--success-color); }
      .mini-stat.stat-warning i { color: var(--warning-color); }
      .mini-stat.stat-danger i { color: var(--danger-color); }
      .section-card:last-child { margin-bottom: 0; }
      .btn-animated {
        background: linear-gradient(135deg, #667eea 60%, #f093fb 100%);
        color: #fff;
        border: none;
        padding: 13px 32px;
        border-radius: 10px;
        font-size: 1.14rem;
        font-weight: bold;
        transition: background 0.27s, box-shadow 0.23s, transform 0.16s;
        cursor: pointer;
        box-shadow: 0 2px 6px rgba(102,126,234,0.21);
        margin: 14px 0 22px 0;
        letter-spacing: 1.18px;
        display: inline-flex;
        align-items: center;
        gap: 12px;
        -webkit-tap-highlight-color: transparent;
      }
      .btn-animated:hover {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        color: #fff;
        transform: scale(1.09) translateY(-4px);
        box-shadow: 0 7px 19px rgba(33, 211, 150, 0.21);
      }
      
      /* Mobile optimizations */
      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 16px;
        }
        .stat-card {
          padding: 20px 16px;
          gap: 12px;
        }
        .stat-icon {
          font-size: 32px;
          padding: 12px;
        }
        .stat-number {
          font-size: 1.8rem;
        }
        .stat-label {
          font-size: 0.9rem;
        }
        .dashboard-sections-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <i class="fas fa-building"></i>
            <span>PG Management</span>
        </div>
        <ul class="nav-menu">
            <li><a href="dashboard.html" class="active"><i class="fas fa-chart-line"></i> Dashboard</a></li>
            <li><a href="guest-form.html"><i class="fas fa-user-plus"></i> Add Guest</a></li>
            <li><a href="guest-list.html"><i class="fas fa-list"></i> Guest List</a></li>
            <li><a href="room-status.html"><i class="fas fa-door-open"></i> Room Status</a></li>
            <li><a href="reports.html"><i class="fas fa-file-alt"></i> Reports</a></li>
            <li><a href="storage.html"><i class="fas fa-database"></i> Storage</a></li>
            <li><a href="admin-profile.html"><i class="fas fa-user-cog"></i> Admin Profile</a></li>
        </ul>
        <button class="btn btn-logout" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </nav>

    <div class="container">
        <div class="page-header">
            <h1><i class="fas fa-chart-line"></i> Dashboard Overview</h1>
            <p>Real-time statistics and actionable insights</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card stat-primary" onclick="openGuestList('all')">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div>
                  <div class="stat-number" id="totalGuests">0</div>
                  <div class="stat-label">Total Guests</div>
                </div>
            </div>
            <div class="stat-card stat-success" onclick="openGuestList('Paid')">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div>
                  <div class="stat-number" id="totalPaid">0</div>
                  <div class="stat-label">Paid This Month</div>
                </div>
            </div>
            <div class="stat-card stat-warning" onclick="openGuestList('Pending')">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div>
                  <div class="stat-number" id="totalPending">0</div>
                  <div class="stat-label">Pending Payments</div>
                </div>
            </div>
            <div class="stat-card stat-danger" onclick="openGuestList('Breached')">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div>
                  <div class="stat-number" id="totalBreached">0</div>
                  <div class="stat-label">Breached Payments</div>
                </div>
            </div>
        </div>

        <button class="btn-animated" onclick="window.location.href='guest-form.html'">
            <i class="fas fa-user-plus"></i> Add New Guest
        </button>

        <div class="dashboard-sections-grid">
            <div class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-building"></i> Building 1 Statistics</h2>
                </div>
                <div>
                  <span class="mini-stat"><i class="fas fa-users"></i> <span id="b1Total">0</span> Total Guests</span>
                  <span class="mini-stat stat-success"><i class="fas fa-money-bill-wave"></i> <span id="b1Paid">0</span> Paid</span>
                  <span class="mini-stat stat-warning"><i class="fas fa-hourglass-half"></i> <span id="b1Pending">0</span> Pending</span>
                  <span class="mini-stat stat-danger"><i class="fas fa-times-circle"></i> <span id="b1Breached">0</span> Breached</span>
                </div>
            </div>
            <div class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-building"></i> Building 2 Statistics</h2>
                </div>
                <div>
                  <span class="mini-stat"><i class="fas fa-users"></i> <span id="b2Total">0</span> Total Guests</span>
                  <span class="mini-stat stat-success"><i class="fas fa-money-bill-wave"></i> <span id="b2Paid">0</span> Paid</span>
                  <span class="mini-stat stat-warning"><i class="fas fa-hourglass-half"></i> <span id="b2Pending">0</span> Pending</span>
                  <span class="mini-stat stat-danger"><i class="fas fa-times-circle"></i> <span id="b2Breached">0</span> Breached</span>
                </div>
            </div>
            <div class="section-card">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Recent Payments Due</h2>
                </div>
                <div id="recentActivity" class="activity-list">
                    <p class="text-center text-muted">Loading recent activity...</p>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>

    <script>
      function openGuestList(filter) {
        // filter: 'all', 'Paid', 'Pending', 'Breached'
        window.location.href = 'guest-list.html?status=' + encodeURIComponent(filter);
      }
    </script>
    
    <!-- Service Worker Registration for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
